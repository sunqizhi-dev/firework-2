<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<title>2026 CYBER NEW YEAR - WeChat Friendly</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<style>
  body,html { margin:0; padding:0; height:100%; overflow:hidden; background:#000; font-family:'Courier New',monospace; touch-action:none; }
  #container { position:absolute; inset:0; }
  #countdown { position:absolute; top:48%; left:50%; transform:translate(-50%,-50%);
    font-size:clamp(90px,22vw,320px); font-weight:900; color:#00ffea; text-shadow:0 0 25px #00ffea, 0 0 50px #ff00aa;
    z-index:10; letter-spacing:-4px; pointer-events:none; mix-blend-mode:screen; }
  #msg { position:absolute; top:65%; left:50%; transform:translate(-50%,0);
    font-size:clamp(28px,6vw,64px); color:#ff00aa; opacity:0; transition:opacity 2.5s; z-index:10;
    text-shadow:0 0 30px #ff00aa; white-space:nowrap; letter-spacing:1px; }
  #tip { position:absolute; bottom:4%; left:50%; transform:translateX(-50%);
    font-size:clamp(14px,3vw,24px); color:#aaa; opacity:0.6; z-index:5; text-align:center; }
</style>
</head>
<body>

<div id="container"></div>
<div id="countdown">10</div>
<div id="msg">2026 已加载 · 暴富启动</div>
<div id="tip">点击任意位置 → 开启音乐 & 烟花</div>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.module.js"
  }
}
</script>

<script type="module">
import * as THREE from 'three';

// Scene setup - 简化版，无postprocessing
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x050014);

const camera = new THREE.PerspectiveCamera(70, innerWidth / innerHeight, 0.1, 2000);
camera.position.set(0, 20, 100);

const renderer = new THREE.WebGLRenderer({ antialias: true, powerPreference: "high-performance" });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5)); // 微信里别拉太高
document.getElementById('container').appendChild(renderer.domElement);

// 简单光源
scene.add(new THREE.AmbientLight(0x404060));
const light = new THREE.PointLight(0x00ffff, 2, 400);
light.position.set(0, 50, 80);
scene.add(light);

// 粒子系统 - 数量控制在8000-10000，微信可承受
const MAX_PARTICLES = 10000;
const geometry = new THREE.BufferGeometry();
const positions = new Float32Array(MAX_PARTICLES * 3);
const colors = new Float32Array(MAX_PARTICLES * 3);
const velocities = new Float32Array(MAX_PARTICLES * 3);
const lives = new Float32Array(MAX_PARTICLES);
const starts = new Float32Array(MAX_PARTICLES);

geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
geometry.setAttribute('velocity', new THREE.BufferAttribute(velocities, 3));
geometry.setAttribute('life', new THREE.BufferAttribute(lives, 1));
geometry.setAttribute('start', new THREE.BufferAttribute(starts, 1));

const material = new THREE.PointsMaterial({
  size: 1.8,
  color: 0xffffff,
  vertexColors: true,
  transparent: true,
  opacity: 0.9,
  blending: THREE.AdditiveBlending,
  depthWrite: false
});

const points = new THREE.Points(geometry, material);
scene.add(points);

let particleIndex = 0;
let currentTime = 0;

function emitFirework(x = 0, y = 0, z = 0, isHeart = false) {
  const hue = isHeart ? 0.85 + Math.random() * 0.1 : Math.random() * 0.15 + 0.7; // neon cyan-purple-pink
  const color = new THREE.Color().setHSL(hue, 1.0, 0.6 + Math.random() * 0.3);
  const count = isHeart ? 120 + Math.random() * 80 : 80 + Math.random() * 60;

  for (let i = 0; i < count; i++) {
    if (particleIndex >= MAX_PARTICLES) particleIndex = 0;
    const idx = particleIndex * 3;

    positions[idx] = x;
    positions[idx + 1] = y;
    positions[idx + 2] = z;

    colors[idx] = color.r;
    colors[idx + 1] = color.g;
    colors[idx + 2] = color.b;

    const angle = Math.random() * Math.PI * 2;
    const speed = 1.2 + Math.random() * 2.0;

    let vx = Math.cos(angle) * speed;
    let vy = Math.sin(angle) * speed;
    let vz = (Math.random() - 0.5) * speed * 0.4;

    if (isHeart) {
      const t = angle;
      vx += Math.sin(t * 4) * 0.3 * speed;
      vy += (Math.sin(t * 2) + Math.cos(t * 3)) * 0.4 * speed;
    }

    velocities[idx] = vx;
    velocities[idx + 1] = vy;
    velocities[idx + 2] = vz;

    lives[particleIndex] = 2.0 + Math.random() * 1.8;
    starts[particleIndex] = currentTime;

    particleIndex++;
  }

  geometry.attributes.position.needsUpdate = true;
  geometry.attributes.color.needsUpdate = true;
  geometry.attributes.velocity.needsUpdate = true;
  geometry.attributes.life.needsUpdate = true;
  geometry.attributes.start.needsUpdate = true;
}

// 零星发射（倒计时中）
setInterval(() => {
  emitFirework(
    (Math.random() - 0.5) * 140,
    -20 + Math.random() * 60,
    (Math.random() - 0.5) * 60,
    Math.random() < 0.3
  );
}, 600);

// 狂欢模式
let intenseMode = false;
function startIntense() {
  intenseMode = true;
  document.getElementById('countdown').style.display = 'none';
  document.getElementById('msg').style.opacity = '1';
}

setInterval(() => {
  if (!intenseMode) return;
  for (let i = 0; i < 3; i++) {
    setTimeout(() => {
      emitFirework(
        (Math.random() - 0.5) * 180,
        -30 + Math.random() * 100,
        (Math.random() - 0.5) * 80,
        Math.random() < 0.45
      );
    }, i * 200);
  }
}, 800);

// 倒计时
let seconds = 10;
const cd = document.getElementById('countdown');
const timer = setInterval(() => {
  seconds--;
  cd.textContent = seconds;
  if (seconds <= 0) {
    clearInterval(timer);
    startIntense();
  }
}, 1000);

// 动画循环
function animate(time) {
  requestAnimationFrame(animate);
  currentTime = time * 0.001;

  for (let i = 0; i < particleIndex; i++) {
    if (lives[i] <= 0) continue;
    const idx = i * 3;
    const age = currentTime - starts[i];

    if (age > lives[i]) {
      lives[i] = 0;
      continue;
    }

    positions[idx] += velocities[idx] * 0.016;
    positions[idx + 1] += velocities[idx + 1] * 0.016 - 0.4 * age * age; // gravity
    positions[idx + 2] += velocities[idx + 2] * 0.016;

    const fade = 1 - (age / lives[i]);
    colors[idx] *= fade * 1.05;
    colors[idx + 1] *= fade * 1.05;
    colors[idx + 2] *= fade * 1.05;
  }

  geometry.attributes.position.needsUpdate = true;
  geometry.attributes.color.needsUpdate = true;

  // 轻微相机移动
  camera.position.x = Math.sin(currentTime * 0.3) * 15;
  camera.position.z = 100 + Math.cos(currentTime * 0.25) * 20;
  camera.lookAt(0, 0, 0);

  renderer.render(scene, camera);
}
animate(0);

// Resize
window.addEventListener('resize', () => {
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});

// 音乐 - 微信必须用户交互
const audio = new Audio('https://assets.codepen.io/605876/synthwave-retro.mp3'); // 替换成你喜欢的链接
audio.volume = 0.3;
audio.loop = true;

document.body.addEventListener('touchstart', () => {
  audio.play().catch(() => {});
}, { once: true });

</script>
</body>
</html>